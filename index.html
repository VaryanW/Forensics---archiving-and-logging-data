<h1>Digital Forensics - </h1>
<body>
<h1>Using commands and simple tools to maintain the CIA (Confedentiality, Integrity, and Availability) of digital forensic evidence</h1>
<p>This was from and exercise early on in a University of Minnesota Cyber Security Bootcamp, and I did not capture any screenshorts, therefore this page will be simple and contain the steps take and explain why they were done.</p>
</body>
<br>
<body>
<h3>The scenario</h3>
<h4>DISCLAIMER: to reduce the likelyhood of this document being used to easily get through work that is meant to educate, and help people grow, I will be omitting the pseudo company name given for this assignment, as well as not mentioning the course itself.</h4>
<p>I am playing the role of a Security Analyst at a financial company. It is my job (and those in my department I would assume) to check and ensure infroatmion remains accurate and available. I created a program (a simple script) to run two tools. 1. Log size 
management using (logrotate) to help automate the process of rotating logs and archiving them for investigation if needed. 2. Log auditing with (auditd) to track events, record the events, detect abuse or unauthorized activity, and create custom reports.
</p>
<br> <br>
<h4>Next I'll go into some of the details on setting up the environment (most of the log files were already created).</h4>
<br>
<p> Step 1: Create, Extract, Compress, and Manage tar Backup Archives<br>
<br>
Command to extract the TarDocs.tar archive to the current directory:<br>
<br>
tar -xvf TarDocs.tar .
Or 
tar -xvf TarDocs.tar /home/sysadmin/Projects<br>

<br>
Command to create the Javaless_Doc.tar archive from the TarDocs/ directory, while excluding the TarDocs/Documents/Java directory:<br>

tar -cvf Javaless_Docs.tar --exclude=TarDocs/Documents/java TarDocs<br>


Command to ensure Java/ is not in the new Javaless_Docs.tar archive:<br>

tar -tvvf Javaless_Docs.tar | grep -w ‘java’<br>
Output gives one file with a java extension, but does not contain the TarDocs/Documents/java folder any more. <br>
<br>
<br>
Optional<br>
 
Command to create an incremental archive called logs_backup.tar.gz with only changed files to snapshot.file for the /var/log directory:<br>

tar -cvzf logs_backup.tar.gz --listed-incremental=snapshot.file /var/log<br>
<br>

Critical Analysis Question<br>

Why wouldn't you use the options -x and -c at the same time with tar?<br>

It doesn’t make sense to create (-c) while also extracting (-x) within the same command. It would be quite redundant and very unnecessary. <br>

Step 2: Create, Manage, and Automate Cron Jobs<br>

Cron job for backing up the /var/log/auth.log file:<br>
<br>
crontab -e 
(I created mine in nano, then added my executable file to the crontab, this is a concatenated version)<br>
0 * * 6 3 sudo tar -cvf auth_backup.tar var/log/auth.log && sudo gzip auth_backup.tgz<br>
<br>
<br>
<br>
Step 3: Write Basic Bash Scripts<br>
<br>
Brace expansion command to create the four subdirectories:<br>
<br>
mkdir ~/backups/{freemem,openlist,diskuse,freedisk}<br>
<br>
<br>
Paste your system.sh script edits:<br>
<br>
#!/bin/bash<br>
free -h >> /home/sysadmin/backups/freemem/free_mem.txt<br>
du -sh >> /home/sysadmin/backups/freedisk/free_disk.txt<br>
lsof >> /home/sysadmin/backups/openlist/open_list.txt<br>
df -Th >>/home/sysadmin/backups/freedisk/free_disk.txt<br>
<br>

<br>

Command to make the system.sh script executable:<br>

./system.sh<br>

<br>

Optional<br>

Commands to test the script and confirm its execution:<br>

./system.sh <br>
Then check the listed directories to ensure they have the correct information.<br>

<br>


Command to copy system to system-wide cron directory:<br>

sudo cp /home/system.sh /etc/cron.weekly<br>
<br>

<br>
Step 4. Manage Log File Sizes<br>
 
Run sudo nano /etc/logrotate.conf to edit the logrotate configuration file. <br>

Configure a log rotation scheme that backs up authentication messages to the /var/log/auth.log. <br>

Add your config file edits:<br>

{<br>
Weekly <br>
Tail -n 7<br>
Notifempty<br>
Compress<br>
Delaycompress<br>
Missingok<br>
}<br>

<br><br>




Optional Additional Challenge: Check for Policy and File Violations<br>

Command to verify `auditd` is active:<br>

sudo auditctl -l<br>
<br>
Output =<br>
-w /etc/shadow -p wra -k hashpass_audit<br>
-w /var/log/auth.log -p wra -k hashpass_audit<br>
-w /etc/passwd -p wra -k hashpass_audit<br>

<br><br>


Command to set number of retained logs and maximum log file size:<br>

sudo nano /etc/audit/auditd.conf<br>
<br>

Add the edits made to the configuration file:<br>

Max_log_file:= 35<br>
Max_log:= 7<br><br>


Command using auditd to set rules for /etc/shadow, /etc/passwd, and /var/log/auth.log:<br>

sudo nano /etc/audit/rules.d/audit.rules<br>
  GNU nano 4.8/etc/audit/rules.d/audit.rules<br>
## First rule - delete all<br>
-D<br><br>

## Increase the buffers to survive stress events.<br>
## Make this bigger for busy systems<br>
-b 8192<br>

## This determine how long to wait in burst of events<br>
--backlog_wait_time 0<br>

## Set failure mode to syslog<br>
-f 1<br><br>

 
Add the edits made to the rules file below:<br>

# Files being monitored and criteria for them.<br>
-w /etc/shadow -p wra -k hashpass_audit<br>
-w /var/log/auth.log -p wra -k hashpass_audit<br>
-w /etc/passwd -p wra -k hashpass_audit<br>
<br>

Command to restart auditd:<br>

systemctl restart auditd<br>


Command to list all auditd rules:<br>

auditd -l<br>


Command to produce an audit report:<br>

sudo cat /var/log/audit/audit.log<br><br>


Create a user with sudo useradd attacker and produce an audit report that lists account modifications:<br>

sudo useradd attacker<br>
sudo usermod -aG sudoer attacker<br><br>


Command to use auditd to watch /var/log/cron:<br>

-w /var/log/cron -p rwa -k selinux_changes<br><br>


Command to verify auditd rules:<br>

sudo auditctl -l<br><br>


Optional (Research Activity): Perform Various Log Filtering Techniques<br>

Command to return journalctl messages with priorities from emergency to error:<br>

#!/bin/bash<br>

sudo journalctl -p 0 ; sudo journalctl -p 1  ; sudo journalctl -p 2 ; sudo journalctl -p 3<br>


Tried using {..} expansion, but it wasn’t running right, so I did this instead. Not sure if it’s the correct command though<br><br>


Command to check the disk usage of the system journal unit since the most recent boot:<br>

sudo journalctl --disk-usage<br>
<br>

Command to remove all archived journal files except the most recent two:<br>

sudo journalctl --vacuum-files=2<br><br>


Command to filter all log messages with priority levels between zero and two, and save output to /home/sysadmin/Priority_High.txt:<br>

sudo journalctl -p 0 ; sudo journalctl -p 1 ; sudo journalctl -p 2<br><br>




</p>
</body> <br><br><br>
<body>I believe this was from my original submission and not the revision I made after grading, so there may be some minor errors, whoever when testing the general functions of these commands, they seem to work on my linux mint VM.</body>
